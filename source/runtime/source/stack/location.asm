; ************************************************************************************************
; ************************************************************************************************
;
;		Name:		location.asm
;		Purpose:	Save/Restore location on stack.
;		Created:	19th April 2023
;		Reviewed: 	No
;		Author : 	Paul Robson (paul@robsons.org.uk)
;
; ************************************************************************************************
; ************************************************************************************************

		.section code

; ************************************************************************************************
;
;					Normalise position so it Y = 0 and save at stack offset +1
;
; ************************************************************************************************

StackSaveCurrentPosition:
		jsr 	FixUpY 						; codePtr,Y is corrected so Y = 0
		phy
		ldy 	#1
		lda 	codePage
		sta 	(runtimeStackPtr),y
		iny
		lda 	codePtr
		sta 	(runtimeStackPtr),y
		iny
		lda 	codePtr+1
		sta 	(runtimeStackPtr),y
		ply
		rts

; ************************************************************************************************
;
;										Close a frame
;
; ************************************************************************************************

StackLoadCurrentPosition:
		ldy 	#1
		lda 	(runtimeStackPtr),y
		sta 	codePage
		iny
		lda 	(runtimeStackPtr),y
		sta 	codePtr
		iny
		lda 	(runtimeStackPtr),y
		sta 	codePtr+1
		ldy 	#0
		rts

		.send code

; ************************************************************************************************
;
;									Changes and Updates
;
; ************************************************************************************************
;
;		Date			Notes
;		==== 			=====
;
; ************************************************************************************************
